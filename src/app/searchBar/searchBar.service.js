(function() {
  'use strict';

  angular
    .module('rss.searchBar')
    .service('SearchBarHandler',['$http','sharedData','$log',SearchBarHandler]);

  /** @ngInject */
  function SearchBarHandler($http,sharedData,$log) {
    var fakeResponse;
    var historyList;
    var service = {
      getFeedFromUrl: getFeedFromUrl
    };

    return service;

    function getFeedFromUrl(url) {
      if (url !== void(0)) {
        return $http.jsonp('http://ajax.googleapis.com/ajax/services/feed/load?callback=JSON_CALLBACK',{params: { v: '1.0', num: '50', q: url}})
          .then(getFeedFromUrlComplete)
          .catch(getFeedFromUrlFailed);
        /*fakeResponse = {"responseData": {"feed":{"feedUrl":"http://www.feedforall.com/sample.xml","title":"FeedForAll Sample Feed","link":"http://www.feedforall.com/industry-solutions.htm","author":"","description":"RSS is a fascinating technology. The uses for RSS are expanding daily. Take a closer look at how various industries are using the benefits of RSS in their businesses.","type":"rss20","entries":[{"title":"RSS Solutions for Restaurants","link":"http://www.feedforall.com/restaurant.htm","author":"","publishedDate":"Tue, 19 Oct 2004 08:09:11 -0700","contentSnippet":"FeedForAll helps Restaurant's communicate with customers. Let your customers know the latest specials or events.\n\nRSS feed uses ...","content":"\u003cb\u003eFeedForAll \u003c/b\u003ehelps Restaurant's communicate with customers. Let your customers know the latest specials or events.\u003cbr\u003e\n\u003cbr\u003e\nRSS feed uses include:\u003cbr\u003e\n\u003ci\u003e\u003cfont color\u003d\"#FF0000\"\u003eDaily Specials \u003cbr\u003e\nEntertainment \u003cbr\u003e\nCalendar of Events \u003c/font\u003e\u003c/i\u003e","categories":["Computers/Software/Internet/Site Management/Content Management"]},{"title":"RSS Solutions for Schools and Colleges","link":"http://www.feedforall.com/schools.htm","author":"","publishedDate":"Tue, 19 Oct 2004 08:09:09 -0700","contentSnippet":"FeedForAll helps Educational Institutions communicate with students about school wide activities, events, and schedules.\n\nRSS ...","content":"FeedForAll helps Educational Institutions communicate with students about school wide activities, events, and schedules.\u003cbr\u003e\n\u003cbr\u003e\nRSS feed uses include:\u003cbr\u003e\n\u003ci\u003e\u003cfont color\u003d\"#0000FF\"\u003eHomework Assignments \u003cbr\u003e\nSchool Cancellations \u003cbr\u003e\nCalendar of Events \u003cbr\u003e\nSports Scores \u003cbr\u003e\nClubs/Organization Meetings \u003cbr\u003e\nLunches Menus \u003c/font\u003e\u003c/i\u003e","categories":["Computers/Software/Internet/Site Management/Content Management"]},{"title":"RSS Solutions for Computer Service Companies","link":"http://www.feedforall.com/computer-service.htm","author":"","publishedDate":"Tue, 19 Oct 2004 08:09:07 -0700","contentSnippet":"FeedForAll helps Computer Service Companies communicate with clients about cyber security and related issues. \n\nUses ...","content":"FeedForAll helps Computer Service Companies communicate with clients about cyber security and related issues. \u003cbr\u003e\n\u003cbr\u003e\nUses include:\u003cbr\u003e\n\u003ci\u003e\u003cfont color\u003d\"#0000FF\"\u003eCyber Security Alerts \u003cbr\u003e\nSpecials\u003cbr\u003e\nJob Postings \u003c/font\u003e\u003c/i\u003e","categories":["Computers/Software/Internet/Site Management/Content Management"]},{"title":"RSS Solutions for Governments","link":"http://www.feedforall.com/government.htm","author":"","publishedDate":"Tue, 19 Oct 2004 08:09:05 -0700","contentSnippet":"FeedForAll helps Governments communicate with the general public about positions on various issues, and keep the community ...","content":"FeedForAll helps Governments communicate with the general public about positions on various issues, and keep the community aware of changes in important legislative issues. \u003cb\u003e\u003ci\u003e\u003cbr\u003e\n\u003c/i\u003e\u003c/b\u003e\u003cbr\u003e\nRSS uses Include:\u003cbr\u003e\n\u003ci\u003e\u003cfont color\u003d\"#00FF00\"\u003eLegislative Calendar\u003cbr\u003e\nVotes\u003cbr\u003e\nBulletins\u003c/font\u003e\u003c/i\u003e","categories":["Computers/Software/Internet/Site Management/Content Management"]},{"title":"RSS Solutions for Politicians","link":"http://www.feedforall.com/politics.htm","author":"","publishedDate":"Tue, 19 Oct 2004 08:09:03 -0700","contentSnippet":"FeedForAll helps Politicians communicate with the general public about positions on various issues, and keep the community ...","content":"FeedForAll helps Politicians communicate with the general public about positions on various issues, and keep the community notified of their schedule. \u003cbr\u003e\n\u003cbr\u003e\nUses Include:\u003cbr\u003e\n\u003ci\u003e\u003cfont color\u003d\"#FF0000\"\u003eBlogs\u003cbr\u003e\nSpeaking Engagements \u003cbr\u003e\nStatements\u003cbr\u003e\n \u003c/font\u003e\u003c/i\u003e","categories":["Computers/Software/Internet/Site Management/Content Management"]},{"title":"RSS Solutions for Meteorologists","link":"http://www.feedforall.com/weather.htm","author":"","publishedDate":"Tue, 19 Oct 2004 08:09:01 -0700","contentSnippet":"FeedForAll helps Meteorologists communicate with the general public about storm warnings and weather alerts, in specific ...","content":"FeedForAll helps Meteorologists communicate with the general public about storm warnings and weather alerts, in specific regions. Using RSS meteorologists are able to quickly disseminate urgent and life threatening weather warnings. \u003cbr\u003e\n\u003cbr\u003e\nUses Include:\u003cbr\u003e\n\u003ci\u003e\u003cfont color\u003d\"#0000FF\"\u003eWeather Alerts\u003cbr\u003e\nPlotting Storms\u003cbr\u003e\nSchool Cancellations \u003c/font\u003e\u003c/i\u003e","categories":["Computers/Software/Internet/Site Management/Content Management"]},{"title":"RSS Solutions for Realtors \u0026 Real Estate Firms","link":"http://www.feedforall.com/real-estate.htm","author":"","publishedDate":"Tue, 19 Oct 2004 08:08:59 -0700","contentSnippet":"FeedForAll helps Realtors and Real Estate companies communicate with clients informing them of newly available properties, and ...","content":"FeedForAll helps Realtors and Real Estate companies communicate with clients informing them of newly available properties, and open house announcements. RSS helps to reach a targeted audience and spread the word in an inexpensive, professional manner. \u003cfont color\u003d\"#0000FF\"\u003e\u003cbr\u003e\n\u003c/font\u003e\u003cbr\u003e\nFeeds can be used for:\u003cbr\u003e\n\u003ci\u003e\u003cfont color\u003d\"#FF0000\"\u003eOpen House Dates\u003cbr\u003e\nNew Properties For Sale\u003cbr\u003e\nMortgage Rates\u003c/font\u003e\u003c/i\u003e","categories":["Computers/Software/Internet/Site Management/Content Management"]},{"title":"RSS Solutions for Banks / Mortgage Companies","link":"http://www.feedforall.com/banks.htm","author":"","publishedDate":"Tue, 19 Oct 2004 08:08:57 -0700","contentSnippet":"FeedForAll helps Banks, Credit Unions and Mortgage companies communicate with the general public about rate changes in a prompt ...","content":"FeedForAll helps \u003cb\u003eBanks, Credit Unions and Mortgage companies\u003c/b\u003e communicate with the general public about rate changes in a prompt and professional manner. \u003cbr\u003e\n\u003cbr\u003e\nUses include:\u003cbr\u003e\n\u003ci\u003e\u003cfont color\u003d\"#0000FF\"\u003eMortgage Rates\u003cbr\u003e\nForeign Exchange Rates \u003cbr\u003e\nBank Rates\u003cbr\u003e\nSpecials\u003c/font\u003e\u003c/i\u003e","categories":["Computers/Software/Internet/Site Management/Content Management"]},{"title":"RSS Solutions for Law Enforcement","link":"http://www.feedforall.com/law-enforcement.htm","author":"","publishedDate":"Tue, 19 Oct 2004 08:08:56 -0700","contentSnippet":"FeedForAll helps Law Enforcement Professionals communicate with the general public and other agencies in a prompt and efficient ...","content":"\u003cb\u003eFeedForAll\u003c/b\u003e helps Law Enforcement Professionals communicate with the general public and other agencies in a prompt and efficient manner. Using RSS police are able to quickly disseminate urgent and life threatening information. \u003cbr\u003e\n\u003cbr\u003e\nUses include:\u003cbr\u003e\n\u003ci\u003e\u003cfont color\u003d\"#0000FF\"\u003eAmber Alerts\u003cbr\u003e\nSex Offender Community Notification \u003cbr\u003e\nWeather Alerts \u003cbr\u003e\nScheduling \u003cbr\u003e\nSecurity Alerts \u003cbr\u003e\nPolice Report \u003cbr\u003e\nMeetings\u003c/font\u003e\u003c/i\u003e","categories":["Computers/Software/Internet/Site Management/Content Management"]}]}}, "responseDetails": null, "responseStatus": 200};
        getFeedFromUrlComplete(fakeResponse.responseData.feed);*/
      }
      return;
    }

    function getFeedFromUrlComplete(response) {
      var feed = response.data.responseData.feed;
      sharedData.setCurrentUrl(feed);
      // update the history list
      historyList = sharedData.getUrlsHistory();
      historyList.unshift(feed);
      sharedData.setActiveFalseToHistoryItems();
      // set the first item in the list as active
      historyList[0].active = true;
      sharedData.setUrlsHistory(historyList);
    }

    function getFeedFromUrlFailed(error) {
      $log.error('XHR Failed for getContributors.\n' + angular.toJson(error.data, true));
    }
  }
})();
